import json
import time
from kafka import KafkaProducer

# Set up Kafka producer
producer = KafkaProducer(
    bootstrap_servers='localhost:9092',
    value_serializer=lambda v: json.dumps(v).encode('utf-8')
)

topic = 'baskets'

file_path = 'C:\\Users\\chris\\RTA\\groceries.csv'

print("Sending baskets from CSV every 5 seconds...")

try:
    with open(file_path, 'r') as f:
        for idx, line in enumerate(f):
            items = [item.strip() for item in line.strip().split(',') if item.strip()]
            if not items:
                continue  # skip empty lines
            basket = {"items": items, "timestamp": time.time()}
            producer.send(topic, basket)
            print(f"Sent basket {idx+1}: {items}")
            time.sleep(1)
except KeyboardInterrupt:
    print("Stopped producer.")
